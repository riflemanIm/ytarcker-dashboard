<!-- русский -->

Этот документ на русском.
See the English version in [README.md](README.md).

# YTracker-Dashboard

... (вступление, функциональность и настройка окружения без изменений) ...
<!-- русский -->

Этот документ на русском.
See the English version in [README.md](README.md).

# YTracker-Dashboard

Этот проект предоставляет минимальную настройку для запуска React в Vite с поддержкой HMR и базовыми правилами ESLint.

В данный момент доступны два официальных плагина:

* [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react/README.md) — использует Babel для Fast Refresh
* [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react-swc) — использует SWC для Fast Refresh

## О проекте

В YTracker-Dashboard вы можете отслеживать время, затраченное на выполнение задач.
Отслеживание времени помогает точнее планировать сроки и бюджеты проектов, а также выявлять узкие места при работе над задачами.

Для удобного учёта предоставлен специальный компонент **TaskTable**, который визуально показывает распределение рабочего времени по задачам в разрезе дней недели. Этот компонент позволяет быстро анализировать, сколько часов потрачено на каждую задачу и за каждый день недели.

Компонент TaskTable поддерживает интерактивное редактирование данных прямо в таблице, автоматически проверяет и преобразует введённые значения в корректный формат длительности (например, можно вводить `1d`, `2h`, `30m`), а также подсвечивает некорректные значения, помогая избежать ошибок. Благодаря этому команда может оперативно контролировать рабочее время и принимать обоснованные решения по управлению проектом.

---

## Функциональность

Ниже приведён обзор всей функциональности YTracker-Dashboard:

* **Аутентификация через Yandex OAuth**
  Пользователи входят через свой аккаунт Яндекса с помощью OAuth для безопасного получения и управления задачами.

* **Автоматический импорт задач**
  После входа в систему дашборд получает список ваших задач из Yandex Tracker, включая `key`, `summary` и поля группировки.

* **Гибкий ввод времени**

  * **Диалог быстрого добавления** для ручного ввода учёта времени: выбор задачи, даты и времени, ввод длительности (поддерживаются форматы `1d`, `2h`, `30m`) и добавление комментария.
  * **Встроенное меню в ячейках** TaskTable для редактирования, добавления или удаления одного или нескольких записей времени для дня/задачи.

* **Интерактивная таблица задач**

  * **Семь колонок** для каждого дня недели и **колонка «Итого»**, генерируются динамически.
  * **Группировка** записей работы по ключу задачи и имени группы.
  * **Суммирование** длительностей по задачам и по дням, с итоговой строкой внизу.
  * **Подсветка текущего дня** для быстрого обнаружения столбца «сегодня».
  * **Сортировка** по значению длительности с помощью ISO-совместимого компаратора.

* **Проверка и нормализация данных**

  * Мгновенная валидация формата ввода длительности.
  * Автоматическое преобразование и нормализация вводимых значений (например, `1h30m`) в единый формат.

* **Навигация по неделям**

  * Встроенный **WeekNavigator** для переключения вперёд или назад на одну неделю.
  * Автоматическая перезагрузка данных при смене недели.

* **Режимы просмотра**

  * Переключение между просмотром **своего** времени и **времени команды**.
  * **Автозаполнение** при выборе сотрудников в режиме «по пользователю».

* **Живые обновления и уведомления**

  * **Индикатор прогресса** во время получения данных.
  * **Snackbar** для вывода сообщений об успехе, ошибках или валидации (например, «Данные сохранены», «Неверный формат длительности» и т.д.).

* **TypeScript и Material-UI**
  Разработано с использованием React + Vite, TypeScript, компонентов Material-UI (DataGrid, Dialogs, Pickers) и dayjs для работы с датами.

---

## Настройка окружения

Создайте файл `.env` в корне проекта и задайте следующие переменные:

```dotenv
VITE_APP_CLIENT_ID=xxxxxxxxxxx
VITE_APP_REDIRECT_URI=https://ytracker.mobimed.ru
VITE_APP_API_URL=https://ytracker.mobimed.ru
```

Где:

* `VITE_APP_CLIENT_ID` — идентификатор OAuth-приложения Яндекса.
* `VITE_APP_REDIRECT_URI` — URL для перенаправления после авторизации.
* `VITE_APP_API_URL` — базовый URL вашего API-доступа.

---

## Методы API

Предоставляются прокси-сервером (порт 4000):
---

## Методы API

Все методы предоставляет прокси-сервер (порт 4000).  
Аутентификация: `token` (OAuth) передаётся либо в query (GET), либо в теле (POST/PATCH).

### **GET `/api/issues`**
Получает записи работы за период.  
**Параметры запроса**:  
- `token` (обязательный)  
- `startDate` (YYYY-MM-DD, обязательный)  
- `endDate` (YYYY-MM-DD, обязательный) → сервер добавляет `T23:59`  
- `userId` (опционально) — фильтр по автору (ID)  
- `login` (опционально) — фильтр по автору (логин)  

**Ответ**
```json
{
  "data": [ /* массив worklog */ ],
  "users": [
    { "id": "123", "name": "Иван Иванов" }
  ]
}
```

---

### **POST `/api/add_time`**
Создаёт новую запись учёта времени.  
**Параметры тела**: token, issueId, start (YYYY-MM-DDTHH:mm), duration (ISO 8601), comment (необяз.).  
**Ответ**: созданный worklog.

---

### **PATCH `/api/edit_time`**
Редактирует запись.  
**Параметры тела**: token, issueId, worklogId, duration, comment (необяз.).  
**Ответ**: обновлённый worklog.

---

### **POST `/api/delete_all`**
Удаляет несколько записей.  
**Параметры тела**: token, issueId, ids (массив ID).  
**Ответ**
```json
true
```

---

### **GET `/api/user_issues`**
Возвращает список задач, назначенных пользователю или созданных им, без дублей.  
**Параметры запроса**: token, userId или login.  

**Ответ**
```json
{
  "issues": [
    { "key": "PROJ-123", "summary": "Исправить баг авторизации" }
  ]
}
```

---

### **GET `/api/issue_type_list`**
Получает список типов задач для указанного entityKey.  
**Параметры запроса**: token, entityKey, email (все обязательные).  

> Для этого метода TLS-проверка отключена. Таймаут: 15 сек.

**Ответ**
```json
{
  "issue_type_list": [ /* ответ внешней системы */ ]
}
```

**Ошибки**
```json
{
  "error": "сообщение",
  "code": "ECONNABORTED",
  "upstreamStatus": 500,
  "upstreamData": { ... }
}
```

---

Не стесняйтесь дорабатывать проект, пулреквесты приветствуются.
